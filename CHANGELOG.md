# Changelog
All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [4.2.1]

### Changed

- Add documentation on the fields in `canboat.xml` in `canboat.xsd`. 
  These are useful for downstream interpreters of the file.
- Make `n2kd` emit a request for PGN 126996 (Product Info) if a source 
  is found that it doesn't have product info for. This allows it to use the
  secondary keys properly, and downstream users can create device -> src mappings.
- `ikonvert-serial` will now send $PDGY strings on stdin to the iKonvert.
  This is useful in debugging scenarios.

## [4.2.0]

### Changed

- XML v2 (`canboat.xml` + `canboat.json`) changes:
  - Added LOOKUP and BITLOOKUP as base field types in the FieldList. This means they
    are easily recognised (they are no longer a NUMBER).
  - Emit `Resolution` even when it is 1. Only stringy and bitfield types now do not have a resolution.
  - Emit `LookupEnumeration` even for fields that have a `Match`.
- XML v2 `canboat.xsl` changes:
  - Show offset for number fields and add textual explanation.

### Issues resolved:

- #283: Further improvements to v2 JSON/XML


## [4.1.0]

### Changed

- Reduce the types of fields reported in the XML and JSON to the base types. A parser needs
  a 'parser' for each FieldType, and each will be different. Copy some attributes to field
  level in the XML. Internally the derived fieldtypes are still used.
- Add an orthogonal `PhysicalQuantity` type in the canboat.xml,json that explains what is stored in the field.
- Cleaner field lists in `canboat.xsl`.

### Issues resolved:

- #311: Fix regression in 4.0.0: PGN 126996 Version field length
- #310: Resolution of field should match field type
- #283: Further improvements to v2 JSON/XML


## [4.0.0]

### Changed

- The default `make` target on top level is now to only build the binaries, not the 
  generated files. This is seems more appropriate for most users.
  Use `make generated` to update all generated files.
- The generated `pgns-v2` files (`.xml` and `.json`) added in 3.0.0 are moved to the
  `docs` subdirectory and renamed to `canboat`.
  They are now accompanied by:
  - `canboat.xsl` for rendering `canboat.xml` in a webbrowser. This is now the main
    documentation page for humans on how the PGN list is built up.
  - `canboat.css` for helping in rendering `canboat.xml` in a webbrowser.
  - `canboat.dtd` for validating `canboat.xml`.
- The older `pgns.xml` and `pgns.json` files are, as much as possible, unchanged but there are still some (breaking) changes:
  - The `RepeatingFields` element was imprecise and was not able to cover all types and manners of repetition, and has been replaced
    by up to six elements.
    `RepeatingFieldSet1Size`
    `RepeatingFieldSet1StartField`
    `RepeatingFieldSet1CountField` (only present if there is a field that contains the number of repetitions, otherwise boundless)
    `RepeatingFieldSet2Size`
    `RepeatingFieldSet2StartField`
    `RepeatingFieldSet2CountField` (only present if there is a field that contains the number of repetitions, otherwise boundless)
  - All fields now have a `Type`.
  - PGN fields no longer have a description `PGN` (which added no value as the field name is also `PGN`.
  - PGN 60416 "ISO Transport Protocol, Connection Management - End Of Message" field id "totalNumberOfPacketsReceived" is now
    "totalNumberOfFramesReceived".
  - The `MissingAttribute` named `Precision` is now named `Resolution` as that is the field attribute that it refers to that is
    missing or uncertain.
  - Power factor fields now have a proper `Resolution` (6.10352e-5) and `Units` attribute.
  - Non-matching ''Manufacturer code'' fields now have a list of manufacturers.
  - Where `Resolution` is 0 it is never output (instead of "usually not".)
  - Small resolutions are now printed in `%g` format not `%f`, so exponential notation is used -- for example `1e-07` instead of
    `0.0000001`.
- The JSON generated by `analyzer` has the following changes and fixes:
  - The '-debug' option now implies the "-nv" option, and "-debug -json" will print the data bytes or bits as hex bytes
    for every field. This makes it very easy to correlate the field with the source data.
  - shorter binary fields were incorrectly printed as a string contain decimal number. They are now printed as a
    space separated sequence of two uppercase hex digits.
  - longer binary fields are now printed the same as above, with uppercase instead of lowercase and no trailing space.
  - Some fields have changed from being a 'number' to a 'time', causing them to be formatted as "hh:mi:ss[.milli]".
    These are:
    - PGN 126993 "Heartbeat" field "Data transmit offset"
    - PGN 127489 "Engine Parameters, Dynamic" field "Total engine hours"
  - Some fields that are really a number are now correctly printed as a number and not as a string:
    - PGN 60928 "ISO Address Claim" field "Unique Number"
  - Empty string fields are now considered 'null', so are only output in json format when -empty is passed.
  - MMSI fields are now a string, and always 9 digits long (so base stations start with "00").
  - PGN 65408 "Airmar: Depth Quality Factor" now contains a lookup for Depth Quality Factor.
  - PGN 130836 "Maretron Proprietary Switch Status Counter" renamed to "Maretron: Switch Status Counter".
  - PGN 130837 "Maretron Proprietary Switch Status Timer" renamed to "Maretron: Switch Status Timer" and
    period fields changed from "decimal" to "time".
- The algorithm for recombining frames into a full fast-packet PGN has been refactored. It now handles out-of-order
  data as produced by the YDGW-02. Some tests have been added to verify that this works.

Issues resolved:

- #305: Print reserved fields only when they are not all ones.
- #304: Print spare fields only when they are not all zeroes.
- #303: Allow lookups to use the values for "Error" and "Unknown".
- #302: Field type has changed for PGNs[].Fields[].Match in pgn JSON/XML.
- #298: Lookup values should say "Temperature", not just "Temp".
- #293: Unify field names for "RAIM", "AIS RAIM Flag" and "AIS RAIM flag" as "RAIM".
- #292: Reactive power unit is "VAR", not "var".
- #291: Units should never contain "seconds".
- #289: Unify spelling of "Repeat Indicator" to have capital I.
- #267: Print User ID as string field, always with 9 digits.
- #283: Enumerations in pgns-v2.json use names for all attributes.
- #285: Fix `SHORT_TIME` field printing incorrect values.

## [3.1.0]

### Added

- #279: Added value 15 'Shaft Seal Temperature' to `TEMPERATURE_SOURCE` lookup.

### Changed

- #282: Lookup table values should be numbers, not strings.
- #273: Fix resolutions for PGN 129541 which contain (very small) 2^-n values.

## [3.0.0] - 2022-09-06

### Added

- #266: Major refactoring, split analyzer-explain off and add better XML and JSON output
- A `dbc-exporter` was added.

### Changed

actisense-serial:
- #255: Fix handling of timeout argument

common:
- #248: Use R bit for PGN number calculation for use with J1939.

analyzer:

- #245: Instance field doesn't need to be qualified with Bank or Inverter, which is implicit.
- #256: Fix length of COG in PGN 129028
- #252: Further fixes for PGN 127507
- #245: Updates for PGNs 126993, 127509, 129541, companylist. Added PGN 130823 Maretron.
- #243: PGN 127507 is fast packet
- #229: Default install prefix should be /usr/local
- #234: Spelling refrigeration
- #244: 127506 is fast packet and add AmpHours field to 127506
- #235: Incorrectly generated schema in pgns.json for Fields.Field values,  Windlass enum values
- #241: Leeway PGN 12800 should contain signed value for leeway

## [2.0.0] - 2021-03-10

### Changed

All software is now licensed via Apache License Version 2.0. Since this 
is a potentially breaking issue for users that can only distribute GPL v3
this is a major version change.

Changes from a contributor that objected to the change have been reverted
(Pull requests #149, #150 and #152) and have been partly rebuilt.

## [1.4.2] - 2021-02-01

### Added

analyzer:

- #223: New windlass and anchor PGNs 128776, 128777, 128778.

## [1.4.1] - 2021-01-28

### Changed

n2kd:

- #157: NMEA0183 output is independent on whether `analyzer` is in `-si` mode.

## [1.4.0] - 2021-01-27

### Added

n2kd:

- #219: New NMEA0183 UDP mode.
- #187: NMEA0183 now writes ZDA message.
- #204: New `-empty` option will show all not-set fields as `null`.
- #222: Support for Furuno GNSS PGNs (65280, 130842-130845) and Heave (127252).

n2kd_monitor:

- #221: Add support for ikonvert-serial.

make:

- #194: Generate manpages with help2man if available.

### Changed

analyzer:

- Updated various PGNs in #205, #206, #200, #197, #191, #190. Affected PGNs:
  127513, 127744, 127745, 127746, 127551, 127550.
- #192: Fixed display of PSI.
- #202: Fixed close detection of output-only streams.
- #193: Fixed compiler compatibility.
- #195: Fixed typos.

format-message:

- #220: Fix length of PGN 127488.

n2kd:

- #218: Improve write reliability and avoid hangs.

all:

- Change copyright to 2021.
- #217: Fix compiler warnings.

## [1.3.0] - 2020-03-04

### Added

analyzer:

- Support for alert PGNs 126983, 126984, 126985.
- Support for Seatalk1 Smart Remote.
- Add type 19 in AtoN type in PGN 129041 (Issue 159.)
- Add rudimentary PGN 127500 data (Issue 175.)
- Add PGN 130569
- Add Chetco dimmer control (PR 178.)
- Add Fusion audio control PGNS (PR 177.)

format-message:

- Add support for PGNs 127506, 127508, 127509, 127488, 127489.
- Add support for writing to YDWG-02.
- Add support for SonicHub audio level PGN 130816.

### Changed

- Restore compatibility with old C compilers.
- Fix makefile for Ubuntu/Debian packaging

analyzer:

- Fix analysis of PGNs with repeating fields but no "# of fields" field.
- PGN fast/single determination is no longer made by number of bytes in PGN (Issue 181.)
  This is also reflected in the XML and JSON files with a new Type attribute.
- Fix transposed Maretron PGN 126270 -> 126720.
- Improve analysis of PGN 127513. Hopefully correct now, but there are still
  conflicting sources (Issue 143.)
- Fix YDWG-02 raw format analysis.
- Improve PGN 127506 lookups.
- Fix incorrect heading/track control fields (PR 179.)
- Fix PGN 126998 (PR 174.)
- Add support for "Special Manoeuver Indicator" in AIS PGNs.
- Fix PGN 127488 (PR 171.)
- Add missing Sequence ID field to PGN 129810 (PR 168.)
- Add missing Reserved field to to PGN 127250 (PR 169.)
- Improve AIS PGNs.
- Fix PGN 127502 to have no repeating fields.

n2kd:

- Add explicit separate server port (2600) for writing to the N2K interface.
- Add explicit separate server port (2601) for AIS data from N2K bus.
- Send both 129026 and 129029 to both normal and AIS clients.
- Fix default parameters in default n2kd config (PR 150.)
- Fix n2kd_monitor forking bug (PR 152.)
- Write AIS data to NMEA0183 format.
- Write NMEA0183 GLL data if position data is only in PGN 129025.

socketcan-writer:

- Write correct can id for both PDU1 and PDU2 messages.
- Replay the frames with original timeframe interval (PR 170.)

ikonvert-serial:

- Fix writing to bus when load is high.
- Allow unlimited rate transmission mode.

actisense-serial:

- Improve writing to bus when load is medium. NGT-1 seems to be unable
  to handle full bandwidth writes.
- Fix writing of messages, in particular those with 10 bytes.

iptee:

- Make it quit again when stdout is not writable
- Fix `iptee -u` for non-listening UDP connections
- Make `iptee -s` operational


## [1.2.1] - 2019-02-01

### Changed
- Update PGN 127489 Fuel Pressure units (Issue 141.)
- Update PGN 127498 ASCII string lengths (Issue 142.)
- Update PGN 127498 Max Speed resolution and unit (Issue 140.)
- Update PGN 65026 Generator AC Real/Apparent Power values should be 4 bytes

## [1.2.0] - 2019-02-01

### Added
- support for Digital Yacht iKonvert
- actisense-serial supports higher baud rates 460800 and 921600 (where supported by OS)
- analyzer can read YDWG-02 logfiles
- replay utility to play back raw logfiles with same rate as they were recorded

### Changed
- Fixed calculation of negative numbers
- Minor fixes to some PGNs.

## [1.1.0] - 2018-10-27

### Added
- Add -version option to all C binaries
- Add hyperlinks to README.md.

### Changed
- Rename + rework README to README.md for better readability on GitHub.
- Reformat all C code with new .clang-format file.
- Refactor use of StringBuffer and logDebug in actisense-serial.

### Removed

## [1.0.0] - 2018-10-21
### Added
- Add version. Since this is a pretty mature product we start at 1.0.0.
- Add changelog (this file).

### Changed

### Removed

## Versions

[Unreleased]: https://github.com/canboat/canboat/compare/v1.0.0...HEAD
[1.0.0]: https://github.com/canboat/canboat/compare/v0.1.0...v1.0.0
